<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåä FloodWatch Demo Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat .number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat .label {
            color: #666;
            font-size: 0.9em;
        }
        
        .stat.severe .number { color: #ef4444; }
        .stat.high .number { color: #f97316; }
        .stat.medium .number { color: #eab308; }
        .stat.low .number { color: #22c55e; }
        .stat.total .number { color: #0066cc; }
        
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .result.loading {
            color: #666;
            font-style: italic;
        }
        
        .result.error {
            color: #ef4444;
            border-left-color: #ef4444;
        }
        
        .result.success {
            color: #22c55e;
            border-left-color: #22c55e;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            margin-bottom: 10px;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .chat-message {
            margin: 10px 0;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .chat-message.user {
            border-left-color: #22c55e;
        }
        
        .chat-message.ai {
            border-left-color: #667eea;
        }
        
        .chat-message strong {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }
        
        details {
            margin-top: 10px;
        }
        
        summary {
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
        }
        
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .badge.high { background: #fef3c7; color: #92400e; }
        .badge.medium { background: #dbeafe; color: #1e40af; }
        .badge.low { background: #d1fae5; color: #065f46; }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåä FloodWatch Demo Dashboard</h1>
            <p>H·ªá th·ªëng Gi√°m s√°t Ng·∫≠p l·ª•t TP.HCM - OLP 2025</p>
        </div>
        
        <!-- Th·ªëng k√™ T·ªïng quan -->
        <div class="card">
            <h2>üìä Th·ªëng k√™ T·ªïng quan</h2>
            <button onclick="loadStats()">üîÑ T·∫£i D·ªØ li·ªáu</button>
            <div id="stats-result" class="result"></div>
        </div>
        
        <div class="grid-2">
            <!-- T√¨m ƒêi·ªÉm Ng·∫≠p G·∫ßn -->
            <div class="card">
                <h2>üîç T√¨m ƒêi·ªÉm Ng·∫≠p G·∫ßn</h2>
                <p><strong>V·ªã tr√≠:</strong> Qu·∫≠n 1 (10.762622, 106.660172)</p>
                <p><strong>B√°n k√≠nh:</strong> 5km</p>
                <button onclick="findNearby()">üîç T√¨m Ki·∫øm</button>
                <div id="nearby-result" class="result"></div>
            </div>
            
            <!-- D·ª± ƒëo√°n Nguy c∆° Ng·∫≠p -->
            <div class="card">
                <h2>üîÆ D·ª± ƒëo√°n Nguy c∆° Ng·∫≠p</h2>
                <p>D·ª± ƒëo√°n nguy c∆° ng·∫≠p trong 6 gi·ªù t·ªõi</p>
                <button onclick="predictFlood()">üîÆ D·ª± ƒëo√°n</button>
                <div id="prediction-result" class="result"></div>
            </div>
        </div>
        
        <!-- AI Chatbot -->
        <div class="card">
            <h2>ü§ñ AI Chatbot</h2>
            <input type="text" id="chat-input" placeholder="H·ªèi v·ªÅ th·ªùi ti·∫øt ho·∫∑c ng·∫≠p l·ª•t... (VD: H√¥m nay Qu·∫≠n 7 c√≥ m∆∞a kh√¥ng?)" 
                   onkeypress="if(event.key === 'Enter') chat()">
            <button onclick="chat()">üí¨ G·ª≠i</button>
            <div id="chat-result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        async function loadStats() {
            const result = document.getElementById('stats-result');
            result.innerHTML = '<div class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/dashboard/stats`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                
                result.innerHTML = `
                    <div class="success">
                        <div class="stats">
                            <div class="stat total">
                                <div class="number">${data.total}</div>
                                <div class="label">T·ªïng ƒëi·ªÉm ng·∫≠p</div>
                            </div>
                            <div class="stat severe">
                                <div class="number">${data.severe}</div>
                                <div class="label">Severe<br>(R·∫•t nguy hi·ªÉm)</div>
                            </div>
                            <div class="stat high">
                                <div class="number">${data.high}</div>
                                <div class="label">High<br>(Nguy hi·ªÉm)</div>
                            </div>
                            <div class="stat medium">
                                <div class="number">${data.medium}</div>
                                <div class="label">Moderate<br>(C·∫ßn ch√∫ √Ω)</div>
                            </div>
                            <div class="stat low">
                                <div class="number">${data.low}</div>
                                <div class="label">Low<br>(An to√†n)</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                            <p><strong>üìä M·ª©c n∆∞·ªõc trung b√¨nh:</strong> ${data.avgWaterLevel}m</p>
                            <p><strong>üå°Ô∏è Sensors:</strong> ${data.sensorCount} ƒëi·ªÉm</p>
                            <p><strong>üë• B√°o c√°o c·ªông ƒë·ªìng:</strong> ${data.communityCount} ƒëi·ªÉm</p>
                            <p><strong>üïê C·∫≠p nh·∫≠t l√∫c:</strong> ${new Date(data.lastUpdated).toLocaleString('vi-VN')}</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå L·ªói: ${error.message}<br><small>ƒê·∫£m b·∫£o API ƒëang ch·∫°y t·∫°i ${API_BASE}</small></div>`;
            }
        }
        
        async function findNearby() {
            const result = document.getElementById('nearby-result');
            result.innerHTML = '<div class="loading">‚è≥ ƒêang t√¨m ki·∫øm...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/flood/nearby?lat=10.762622&lng=106.660172&radius=5`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                const total = data.total_crowd + data.total_sensor;
                
                result.innerHTML = `
                    <div class="success">
                        <p><strong>‚úÖ T√¨m th·∫•y ${total} ƒëi·ªÉm ng·∫≠p trong b√°n k√≠nh 5km</strong></p>
                        <p>üìù B√°o c√°o c·ªông ƒë·ªìng: <strong>${data.total_crowd}</strong></p>
                        <p>üå°Ô∏è D·ªØ li·ªáu sensor: <strong>${data.total_sensor}</strong></p>
                        ${total > 0 ? `
                            <details>
                                <summary>üìã Xem chi ti·∫øt (${data.crowd_reports.length + data.sensor_data.length} ƒëi·ªÉm)</summary>
                                <pre style="max-height: 300px; overflow-y: auto;">${JSON.stringify(data, null, 2)}</pre>
                            </details>
                        ` : '<p style="color: #666; margin-top: 10px;">Kh√¥ng c√≥ ƒëi·ªÉm ng·∫≠p trong khu v·ª±c n√†y.</p>'}
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå L·ªói: ${error.message}</div>`;
            }
        }
        
        async function predictFlood() {
            const result = document.getElementById('prediction-result');
            result.innerHTML = '<div class="loading">‚è≥ ƒêang d·ª± ƒëo√°n...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/flood/prediction`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                const risk = data.prediction.next_6h_risk;
                const riskPercent = (risk * 100).toFixed(1);
                
                let riskLevel, riskColor, riskEmoji;
                if (risk > 0.7) {
                    riskLevel = 'CAO';
                    riskColor = '#ef4444';
                    riskEmoji = 'üî¥';
                } else if (risk > 0.4) {
                    riskLevel = 'TRUNG B√åNH';
                    riskColor = '#eab308';
                    riskEmoji = 'üü°';
                } else {
                    riskLevel = 'TH·∫§P';
                    riskColor = '#22c55e';
                    riskEmoji = 'üü¢';
                }
                
                result.innerHTML = `
                    <div class="success">
                        <h3 style="color: ${riskColor}; margin-bottom: 10px;">
                            ${riskEmoji} Nguy c∆° ng·∫≠p 6 gi·ªù t·ªõi: <strong>${riskLevel}</strong>
                        </h3>
                        <p><strong>Risk Score:</strong> ${riskPercent}%</p>
                        <p style="margin-top: 10px;"><strong>üí° L·ªùi khuy√™n:</strong></p>
                        <p style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 5px;">
                            ${data.prediction.advisory.message}
                        </p>
                        ${data.prediction.high_risk_zones.length > 0 ? `
                            <p style="margin-top: 15px;"><strong>‚ö†Ô∏è C√°c v√πng nguy c∆° cao:</strong></p>
                            <ul style="margin-top: 5px; padding-left: 20px;">
                                ${data.prediction.high_risk_zones.slice(0, 5).map(z => 
                                    `<li>${z.name} (${z.district}) - Risk: <strong>${(z.predicted_risk * 100).toFixed(0)}%</strong></li>`
                                ).join('')}
                            </ul>
                        ` : ''}
                        <details style="margin-top: 10px;">
                            <summary>üìä Xem chi ti·∫øt factors</summary>
                            <pre style="margin-top: 5px;">${JSON.stringify(data.prediction.factors, null, 2)}</pre>
                        </details>
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå L·ªói: ${error.message}</div>`;
            }
        }
        
        async function chat() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            const result = document.getElementById('chat-result');
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.innerHTML = `<strong>üë§ B·∫°n:</strong> ${message}`;
            result.appendChild(userMessage);
            
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'chat-message loading';
            loadingMsg.innerHTML = '‚è≥ AI ƒëang suy nghƒ©...';
            result.appendChild(loadingMsg);
            
            input.value = '';
            input.disabled = true;
            
            try {
                const response = await fetch(`${API_BASE}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, session_id: 'demo' })
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                loadingMsg.remove();
                
                const aiMessage = document.createElement('div');
                aiMessage.className = 'chat-message ai';
                aiMessage.innerHTML = `<strong>ü§ñ AI:</strong> ${data.response}`;
                result.appendChild(aiMessage);
                
                result.scrollTop = result.scrollHeight;
            } catch (error) {
                loadingMsg.remove();
                const errorMsg = document.createElement('div');
                errorMsg.className = 'chat-message error';
                errorMsg.innerHTML = `‚ùå L·ªói: ${error.message}`;
                result.appendChild(errorMsg);
            } finally {
                input.disabled = false;
                input.focus();
            }
        }
        
        // Auto-load stats on page load
        window.addEventListener('load', () => {
            setTimeout(loadStats, 500);
        });
    </script>
</body>
</html>

